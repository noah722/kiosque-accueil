<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accueil ‚Äì L-Pittet</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink: #ec95ff;
      --pink-soft: rgba(236,149,255,.18);
      --pink-strong: #ff7adf;

      --bg:#07152b;
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.72);

      --card:rgba(255,255,255,.10);
      --card2:rgba(255,255,255,.07);
      --stroke:rgba(255,255,255,.14);

      --btn:rgba(236,149,255,.14);
      --btnHover:rgba(236,149,255,.22);

      --danger:#ff5c65;

      --radius:26px;
      --shadow:0 20px 60px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 900px at 15% 10%, rgba(236,149,255,.25), transparent 55%),
        radial-gradient(900px 700px at 85% 20%, rgba(255,122,223,.18), transparent 55%),
        radial-gradient(900px 700px at 70% 95%, rgba(255,255,255,.06), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .wrap{width:min(980px,100%)}

    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      margin-bottom:18px;
    }

    .brand h1{margin:0;font-size:22px;letter-spacing:.3px}
    .brand p{margin:2px 0 0 0;font-size:14px;color:var(--muted)}

    .card{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      padding:26px;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }

    .screen{display:none}
    .screen.active{display:block}

    .top{
      display:flex;
      justify-content:space-between;
      gap:20px;
      flex-wrap:wrap;
      align-items:flex-start;
    }

    .title h2{
      margin:0 0 8px 0;
      font-size:38px;
      line-height:1.1;
      letter-spacing:-.3px;
    }
    .title p{margin:0;font-size:18px;color:var(--muted)}

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      font-size:14px;
      color:var(--muted);
      user-select:none;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background:var(--pink);
      box-shadow:0 0 0 6px rgba(236,149,255,.18);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:14px;
      margin-top:18px;
    }

    button.big{
      appearance:none;
      border:none;
      cursor:pointer;
      padding:18px;
      min-height:74px;
      border-radius:22px;
      background: linear-gradient(135deg, rgba(236,149,255,.28), rgba(236,149,255,.12));
      border:1px solid rgba(236,149,255,.35);
      color:var(--text);
      font-size:20px;
      font-weight:900;
      display:flex;
      align-items:center;
      gap:14px;
      width:100%;
      text-align:left;
      transition: background .2s ease, transform .06s ease, box-shadow .2s ease;
      -webkit-tap-highlight-color: transparent;
    }
    button.big:hover{
      background: linear-gradient(135deg, rgba(236,149,255,.38), rgba(236,149,255,.18));
      box-shadow: 0 0 0 4px rgba(236,149,255,.18);
    }
    button.big:active{ transform: scale(.98); }

    .icon{
      width:44px;height:44px;
      border-radius:16px;
      display:grid;
      place-items:center;
      background: rgba(236,149,255,.22);
      border: 1px solid rgba(236,149,255,.35);
      font-size:22px;
      flex:0 0 auto;
    }

    .choices{
      display:flex;
      gap:14px;
      margin-top:22px;
      flex-wrap:wrap;
    }
    .choice{
      flex:1;
      min-width:260px;
      padding:20px;
      border-radius:22px;
      border:1px solid var(--stroke);
      background:var(--btn);
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      font-size:22px;
      font-weight:900;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .choice:hover{background:var(--btnHover)}
    .choice.alt{outline:2px solid rgba(236,149,255,.25)}

    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:15px;
      line-height:1.35;
    }

    .form{
      margin-top:18px;
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:12px;
    }
    .field{display:flex;flex-direction:column;gap:8px}
    label{font-size:14px;color:var(--muted);font-weight:800}
    input{
      width:100%;
      padding:14px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.08);
      color:var(--text);
      font-size:18px;
      outline:none;
    }
    input:focus{
      border-color: var(--pink);
      box-shadow: 0 0 0 4px var(--pink-soft);
    }
    .full{grid-column:1/-1}

    .actionsRow{
      margin-top:16px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btnSmall{
      min-height:56px;
      font-size:18px;
      font-weight:900;
      padding:14px 16px;
      border-radius:18px;
      border:1px solid var(--stroke);
      background:var(--btn);
      color:var(--text);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .btnSmall:hover{background:var(--btnHover)}
    .btnPrimary{
      background: linear-gradient(135deg, var(--pink-strong), var(--pink));
      border: none;
      box-shadow: 0 10px 30px rgba(236,149,255,.35);
    }
    .btnPrimary:hover{ filter: brightness(1.05); }

    .btnDanger{
      background: rgba(255,92,101,.14);
      border: 1px solid rgba(255,92,101,.35);
    }
    .btnDanger:hover{
      background: rgba(255,92,101,.22);
    }

    .error{
      margin-top:12px;
      padding:12px 14px;
      border-radius:16px;
      border:1px solid rgba(255,92,101,.35);
      background:rgba(255,92,101,.10);
      color:rgba(255,255,255,.92);
      display:none;
      font-size:15px;
      font-weight:800;
    }

    /* √©crans "grand message" */
    .center{text-align:center;padding:26px 8px}
    .center h2{
      margin:0 0 10px 0;
      font-size:52px;
      line-height:1.05;
      letter-spacing:-.6px;
    }
    .center .bigMsg{
      font-size:24px;
      line-height:1.35;
      color:rgba(255,255,255,.88);
      margin:0 auto;
      max-width: 820px;
    }

    .spinner{
      margin:22px auto 0;
      width:46px;height:46px;border-radius:999px;
      border:4px solid rgba(255,255,255,.2);
      border-top-color:var(--pink);
      animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .version{
      position:absolute;
      right:14px;bottom:10px;
      font-size:12px;
      color:rgba(255,255,255,.45);
      user-select:none;
    }

    @media(max-width:720px){
      .grid{grid-template-columns:1fr}
      .form{grid-template-columns:1fr}
      .title h2{font-size:30px}
      .center h2{font-size:42px}
      .center .bigMsg{font-size:20px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="brand">
      <div>
        <h1>Accueil</h1>
        <p>On est l√† pour t‚Äôaider.</p>
      </div>
    </div>

    <div class="card">
      <!-- STEP 1 -->
      <div id="s1" class="screen active">
        <div class="top">
          <div class="title">
            <h2>Bienvenue üëã</h2>
            <p>Choisis ce que tu viens faire aujourd‚Äôhui.</p>
          </div>
          <div class="pill"><span class="dot"></span> R√©ception</div>
        </div>

        <div class="grid">
          <button type="button" class="big" onclick="pick('info')">
            <span class="icon">‚ÑπÔ∏è</span> Informations et r√©servations
          </button>

          <button type="button" class="big" onclick="pick('cours')">
            <span class="icon">üìö</span> J‚Äôai un cours r√©serv√©
          </button>

          <button type="button" class="big" onclick="pick('moto')">
            <span class="icon">üèçÔ∏è</span> J‚Äôai lou√© une moto
          </button>

          <button type="button" class="big" onclick="pick('equip')">
            <span class="icon">üß§</span> Je souhaite louer de l‚Äô√©quipement
          </button>
        </div>

        <p class="hint">Tes informations servent uniquement √† t‚Äôaccueillir et t‚Äôorienter.</p>
      </div>

      <!-- STEP 2 : choix type de cours -->
      <div id="s2" class="screen">
        <div class="top">
          <div class="title">
            <h2>Ton cours est :</h2>
            <p class="hint">Choisis une option.</p>
          </div>
          <div class="pill"><span class="dot"></span> √âtape 1/2</div>
        </div>

        <div class="choices">
          <div class="choice alt" onclick="pick('cours_prive')">
            <span>üë§ Cours priv√©</span><span style="color:var(--pink)">OK</span>
          </div>
          <div class="choice alt" onclick="pick('cours_groupe')">
            <span>üë• Cours en groupe</span><span style="color:var(--pink)">OK</span>
          </div>
        </div>

        <div class="actionsRow">
          <button type="button" class="btnSmall" onclick="resetAll()">‚Ü©Ô∏è Retour</button>
        </div>
      </div>

      <!-- STEP 3 : coordonn√©es (uniquement info/equip) -->
      <div id="s3" class="screen">
        <div class="top">
          <div class="title">
            <h2 id="formTitle">Tes coordonn√©es</h2>
            <p id="formSubtitle" class="hint"></p>
          </div>
          <div class="pill"><span class="dot"></span> √âtape 1/2</div>
        </div>

        <div class="form">
          <div class="field">
            <label for="firstName">Pr√©nom *</label>
            <input id="firstName" autocomplete="given-name" placeholder="Ex : Noah" />
          </div>

          <div class="field">
            <label for="lastName">Nom *</label>
            <input id="lastName" autocomplete="family-name" placeholder="Ex : Pittet" />
          </div>

          <div id="phoneField" class="field full" style="display:none;">
            <label for="phone">T√©l√©phone *</label>
            <input id="phone" autocomplete="tel" placeholder="Ex : 079 123 45 67" />
          </div>

          <div class="field full">
            <div class="hint" id="instructions"></div>
          </div>
        </div>

        <div id="err" class="error"></div>

        <div class="actionsRow">
          <button type="button" class="btnSmall" onclick="resetAll()">‚Ü©Ô∏è Revenir au d√©but</button>
          <button type="button" class="btnSmall btnPrimary" onclick="submitForm()">Continuer</button>
        </div>
      </div>

      <!-- STEP 4 : consignes (cours + moto) -->
      <div id="s4" class="screen">
        <div class="center">
          <h2 id="actionTitle">Parfait ‚úÖ</h2>
          <p id="actionText" class="bigMsg">...</p>

          <div class="actionsRow" style="justify-content:center;margin-top:22px;">
            <button type="button" class="btnSmall btnDanger" onclick="requestAdminHelp()">
              Je souhaite parler √† quelqu‚Äôun de l‚Äôadmin
            </button>
            <button type="button" class="btnSmall btnPrimary" onclick="goHomeSoon()">
              OK
            </button>
          </div>

          <p class="hint" style="margin-top:16px;">
            Si tu ne cliques sur rien, retour √† l‚Äôaccueil automatiquement.
          </p>
        </div>
      </div>

      <!-- STEP 5 : message final (apr√®s coordonn√©es / apr√®s admin) -->
      <div id="s5" class="screen">
        <div class="center">
          <h2 id="finalTitle">Merci üôè</h2>
          <p id="finalText" class="bigMsg">C‚Äôest not√©.</p>
          <div class="spinner" aria-hidden="true"></div>
          <p style="margin-top:14px;color:var(--muted);font-size:18px;">
            Retour √† l‚Äôaccueil dans <span id="count">15</span>‚Ä¶
          </p>
        </div>
      </div>

      <div class="version">VERSION: FLOW-UX-2</div>
    </div>
  </div>

<script>
  const MAKE_WEBHOOK_URL = "https://hook.eu2.make.com/wezbhxrv8u3n9h6ilgda2rw3e57r5y26";
  const AGENCY = "R√©ception";

  const DEFAULT_RETURN_SECONDS = 15;

  const state = {
    flow: null,
    needPhone: false,
    autoTimer: null
  };

  function show(id){
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  function clearAutoTimer(){
    if(state.autoTimer){
      clearTimeout(state.autoTimer);
      state.autoTimer = null;
    }
  }

  function resetAll(){
    clearAutoTimer();
    state.flow = null;
    state.needPhone = false;

    document.getElementById("firstName").value = "";
    document.getElementById("lastName").value = "";
    document.getElementById("phone").value = "";
    document.getElementById("phoneField").style.display = "none";
    document.getElementById("err").style.display = "none";

    show("s1");
  }

  function pick(flow){
    clearAutoTimer();

    if(flow === "cours"){
      show("s2");
      return;
    }

    state.flow = flow;

    // 1) info/equip -> coordonn√©es d'abord (s3)
    if(flow === "info" || flow === "equip"){
      configureForm(flow);
      show("s3");
      return;
    }

    // 2) cours + moto -> consignes direct (s4)
    configureAction(flow);
    show("s4");

    // retour auto si pas de clic
    state.autoTimer = setTimeout(() => resetAll(), DEFAULT_RETURN_SECONDS * 1000);
  }

  function configureForm(flow){
    state.needPhone = (flow === "equip");
    document.getElementById("phoneField").style.display = state.needPhone ? "block" : "none";

    const subtitle = document.getElementById("formSubtitle");
    const instructions = document.getElementById("instructions");

    if(flow === "info"){
      subtitle.textContent = "Indique ton pr√©nom et ton nom, puis on te met en relation.";
      instructions.textContent = "Ensuite, un message te dira quoi faire.";
    } else {
      subtitle.textContent = "Indique ton pr√©nom, ton nom et ton t√©l√©phone.";
      instructions.textContent = "Ensuite, on pr√©vient une personne qui vient t‚Äôaider.";
    }

    document.getElementById("err").style.display = "none";
  }

  function configureAction(flow){
    const title = document.getElementById("actionTitle");
    const text = document.getElementById("actionText");

    title.textContent = "Voici ce que tu dois faire ‚úÖ";

    if(flow === "cours_prive"){
      text.textContent = "Installe-toi, prends un verre √† la caf√©t√©ria ou va aux toilettes. Ton moniteur vient te chercher tr√®s bient√¥t.";
    } else if(flow === "cours_groupe"){
      text.textContent = "Ton cours a lieu dans la salle de cours. Tu peux entrer et tourner √† droite derri√®re ce comptoir.";
    } else if(flow === "moto"){
      text.textContent = "Un SMS est envoy√© 15 minutes avant le d√©but de ta location avec un lien. Clique dessus pour obtenir ton code cl√©, puis r√©cup√®re ta moto et profite üèçÔ∏è";
    } else {
      text.textContent = "Ok.";
    }
  }

  function flowLabel(flow){
    if(flow === "info") return "Informations et r√©servations";
    if(flow === "cours_prive") return "Cours r√©serv√© - priv√©";
    if(flow === "cours_groupe") return "Cours r√©serv√© - groupe";
    if(flow === "moto") return "Location moto";
    if(flow === "equip") return "Location √©quipement";
    return "Inconnu";
  }

  function showError(msg){
    const e = document.getElementById("err");
    e.textContent = msg;
    e.style.display = "block";
  }

  function validateForm(){
    const fn = document.getElementById("firstName").value.trim();
    const ln = document.getElementById("lastName").value.trim();
    const ph = document.getElementById("phone").value.trim();

    if(!fn || !ln){
      showError("Merci de renseigner au minimum le pr√©nom et le nom.");
      return false;
    }
    if(state.needPhone && !ph){
      showError("Merci de renseigner ton t√©l√©phone.");
      return false;
    }
    document.getElementById("err").style.display = "none";
    return true;
  }

  function startCountdown(seconds){
    let s = seconds;
    const el = document.getElementById("count");
    el.textContent = String(s);

    const t = setInterval(() => {
      s -= 1;
      el.textContent = String(s);
      if(s <= 0){
        clearInterval(t);
        resetAll();
      }
    }, 1000);
  }

  async function sendWebhook(extra = {}){
    const payload = {
      firstName: (document.getElementById("firstName")?.value || "").trim() || null,
      lastName: (document.getElementById("lastName")?.value || "").trim() || null,
      phone: (document.getElementById("phone")?.value || "").trim() || null,

      flow: state.flow,
      flowLabel: flowLabel(state.flow),

      agency: AGENCY,
      timestamp: new Date().toISOString(),

      ...extra
    };

    try{
      await fetch(MAKE_WEBHOOK_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
    } catch(e){
      console.warn("Webhook error", e);
    }
  }

  // 1) info/equip: apr√®s coordonn√©es -> √©cran final long
  async function submitForm(){
    if(!validateForm()) return;

    clearAutoTimer();

    // on envoie au webhook (pour que Notion/Slack etc. marche)
    await sendWebhook({
      needsSecretary: (state.flow === "equip"),
      needsAdmin: false
    });

    showFinalAfterForm();
  }

  function showFinalAfterForm(){
    show("s5");

    const finalTitle = document.getElementById("finalTitle");
    const finalText = document.getElementById("finalText");

    if(state.flow === "equip"){
      finalTitle.textContent = "Merci üôè";
      finalText.textContent = "Quelqu‚Äôun arrive tr√®s bient√¥t pour t‚Äôaider.";
    } else {
      finalTitle.textContent = "Merci üôè";
      finalText.textContent = "Quelqu‚Äôun arrive tr√®s bient√¥t pour te renseigner.";
    }

    startCountdown(DEFAULT_RETURN_SECONDS);
  }

  // 2) cours/moto: bouton OK -> retour accueil (sans appeler admin)
  function goHomeSoon(){
    clearAutoTimer();
    show("s5");
    document.getElementById("finalTitle").textContent = "Parfait ‚úÖ";
    document.getElementById("finalText").textContent = "Tu peux suivre les consignes ci-dessus.";
    startCountdown(DEFAULT_RETURN_SECONDS);
  }

  // 3) cours/moto: bouton admin -> webhook + message final long
  async function requestAdminHelp(){
    clearAutoTimer();

    // webhook pour l‚Äôadmin (utile pour router Make -> Slack/Notion)
    await sendWebhook({
      needsSecretary: true,
      needsAdmin: true
    });

    show("s5");
    document.getElementById("finalTitle").textContent = "C‚Äôest not√© ‚úÖ";
    document.getElementById("finalText").textContent = "Quelqu‚Äôun de l‚Äôadministration arrive tr√®s bient√¥t pour t‚Äôaider.";
    startCountdown(DEFAULT_RETURN_SECONDS);
  }
</script>

</body>
</html>
